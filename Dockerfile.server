FROM rust:latest AS builder

WORKDIR /app
COPY . .
ENV SQLX_OFFLINE=true
RUN cargo build --release --bin mothership-server

FROM debian:bookworm-slim
RUN apt-get update && apt-get install -y \
    ca-certificates \
    curl \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY --from=builder /app/target/release/mothership-server /app/mothership-server

# OAuth success page is served from inline template in Rust code

EXPOSE 7523
CMD ["./mothership-server"] 